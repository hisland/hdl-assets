<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title> new document </title>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />

	<script type="text/javascript" src="../patch.javascript.js"></script>
	<script type="text/javascript" src="../jquery-1.4.2.js"></script>
	<script type="text/javascript" src="../jquery.mousewheel.js"></script>
	<script type="text/javascript" src="../jquery.adjustElement.js"></script>
	<link rel="stylesheet" type="text/css" href="../../styles/reset.css" />
	<style type="text/css">
		body{margin:50px;}
	</style>
	<script type="text/javascript">
		$(function(){
			function yearDays(year){
				return year%400==0 || (year%4==0 && year%100!=0) ? 366 : 365;
			}
			function getYearFirstDay(year){
				var first_day = new Date(year+'/1/1').getDay();
				if(first_day == 0){
					first_day = 7;
				}
				return first_day;
			}
			function makeList(start, end){
				var str = [];
				for( ; start <= end; start++){
					str.push('<option value="'+start+'">'+start+'</option>');
				}
				return str.join('');
			}
			function refreshIpt(only_end){
				var  year = $('#week-select-year').val()
					,ipt_start = $('#date-start')
					,ipt_end = $('#date-end')
					,start = $('#week-select-start').val()-0
					,end = $('#week-select-end').val()-0
					,first_day = getYearFirstDay(year)
					,base_days = 0
					,base_date = new Date(year+'/1/1');

				if(first_day > 1){
					base_days = 8 - first_day;
				}

				if(!only_end){
					if(base_days>0){
						base_date = new Date(base_date.valueOf()+base_days*86400000);
						ipt_start.val(new Date(base_date.valueOf()+(start-2)*7*86400000).dateTimeString());
						ipt_end.val(new Date(base_date.valueOf()+(end-1)*7*86400000-1).dateTimeString());
					}else{
						ipt_start.val(new Date(base_date.valueOf()+(start-1)*7*86400000).dateTimeString());
						ipt_end.val(new Date(base_date.valueOf()+end*7*86400000-1).dateTimeString());
					}
				}else{
					if(base_days>0){
						base_date = new Date(base_date.valueOf()+base_days*86400000);
						ipt_end.val(new Date(base_date.valueOf()+(end-1)*7*86400000-1).dateTimeString());
					}else{
						ipt_end.val(new Date(base_date.valueOf()+end*7*86400000-1).dateTimeString());
					}
				}
			}
			function yearChange(e){
				refreshIpt();
			}
			function weekStartChange(e){
				var  select_end = $('#week-select-end')
					,start = this.value-0
					,end = select_end.val()-0
				if(start > end){
					select_end.html(makeList(start, 53));
					end = start;
				}else{
					select_end.html(makeList(start, 53));
					select_end.val(end);
				}
				refreshIpt();
			}
			function weekEndChange(e){
				refreshIpt(true);
			}

			$('#week-select-year').html(makeList(2008, 2015)).change(yearChange);
			$('#week-select-start').html(makeList(1, 53)).change(weekStartChange);
			$('#week-select-end').html(makeList(1, 53)).change(weekEndChange);
		});
	</script>
</head>

<body>
	<select name="" id="week-select-year"></select>年 第<select name="" id="week-select-start"></select>-<select name="" id="week-select-end"></select>周

	<input id="date-start" type="text" name="" value="" readonly="readonly"  />
	<input id="date-end" type="text" name="" value="" readonly="readonly"  />
</body>
</html>
